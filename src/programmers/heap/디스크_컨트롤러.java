package programmers.heap;

import java.util.Arrays;
import java.util.Comparator;
import java.util.PriorityQueue;

public class ë””ìŠ¤í¬_ì»¨íŠ¸ë¡¤ëŸ¬ {
    // goal : 1 . ì–´ë–¤ ì‘ì—… ìš”ì²­ì´ ë“¤ì–´ì™”ì„ ë•Œ ì‘ì—…ì˜ ë²ˆí˜¸, ì‘ì—…ì˜ ìš”ì²­ ì‹œê°, ì‘ì—…ì˜ ì†Œìš” ì‹œê°„ì„ ì €ì¥í•´ ë‘ëŠ” ëŒ€ê¸° íê°€ ìˆìŠµë‹ˆë‹¤. ì²˜ìŒì— ì´ íëŠ” ë¹„ì–´ìˆìŠµë‹ˆë‹¤.
    //        2 . í•˜ë“œë””ìŠ¤í¬ê°€ ì‘ì—…ì„ í•˜ê³  ìˆì§€ ì•Šê³  ëŒ€ê¸° íê°€ ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©´ ê°€ì¥ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ì‘ì—…ì„ ëŒ€ê¸° íì—ì„œ êº¼ë‚´ì„œ í•˜ë“œë””ìŠ¤í¬ì— ê·¸ ì‘ì—…ì„ ì‹œí‚µë‹ˆë‹¤.
    //             -  ì‘ì—…ì˜ " 1 ìˆœìœ„ : ì†Œìš”ì‹œê°„ì´ ì§§ì€ ê²ƒ,
    //                       2 ìˆœìœ„ : ì‘ì—…ì˜ ìš”ì²­ ì‹œê°ì´ ë¹ ë¥¸ ê²ƒ,
    //                       3 ìˆœìœ„ : ì‘ì—…ì˜ ë²ˆí˜¸ê°€ ì‘ì€ ê²ƒ ìˆœìœ¼ë¡œ ìš°ì„ ìˆœìœ„ê°€ ë†’ìŠµë‹ˆë‹¤.
    //        3 . í•˜ë“œë””ìŠ¤í¬ëŠ” ì‘ì—…ì„ í•œ ë²ˆ ì‹œì‘í•˜ë©´ ì‘ì—…ì„ ë§ˆì¹  ë•Œê¹Œì§€ ê·¸ ì‘ì—…ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
    // condition : - 1 â‰¤ jobsì˜ ê¸¸ì´ â‰¤ 500
    //            - jobs[i]ëŠ” ië²ˆ ì‘ì—…ì— ëŒ€í•œ ì •ë³´ì´ê³  [s, l] í˜•íƒœì…ë‹ˆë‹¤.
    //            - sëŠ” ì‘ì—…ì´ ìš”ì²­ë˜ëŠ” ì‹œì ì´ë©° 0 â‰¤ s â‰¤ 1,000ì…ë‹ˆë‹¤.
    //            - lì€ ì‘ì—…ì˜ ì†Œìš”ì‹œê°„ì´ë©° 1 â‰¤ l â‰¤ 1,000ì…ë‹ˆë‹¤.
    public static void main(String[] args){
        int[][] jobs= {{0, 3}, {1, 9}, {3, 5}};
        new ë””ìŠ¤í¬_ì»¨íŠ¸ë¡¤ëŸ¬().solution(jobs);
    }

    // ğŸ‘ ì˜ëª»ëœ í’€ì´ 3 ìˆœìœ„ ë¹„êµ ì‘ì—…ì´ ëˆ„ë½ë˜ì—ˆìŒ
    public int solution(int[][] jobs) {
        //  ì‘ì—…ì˜ ìš”ì²­ ì‹œê° ê¸°ì¤€ ì •ë ¬
        Arrays.sort(jobs, Comparator.comparingInt(a -> a[0]));

        // ìš°ì„  ìˆœìœ„ Queue ìƒì„± - ì‘ì—… ìˆœì„œë¥¼ ì œì™¸í•œ ì†Œìš” ì‹œê°„ê³¼, ìš”ì²­ ì‹œì ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
        // Index0 : ìš”ì²­ ì‹œì 
        // Index1 : ì‘ì—… ì†Œìš” ì‹œê°„
        PriorityQueue<int[]> priorityQueue = new PriorityQueue<>(
                // ìˆœìœ„ì— ë§ê²Œ ì‘ì—… ì‘ì—… ìš”ì²­ ì‹œê° ë¹„êµ í›„ ê°™ì„ ê²½ìš°ì—ëŠ” ì†Œìš” ì‹œê°„ ì •ë ¬
                (a,b)-> a[1] != b[1] ? a[1] - b[1] : a[0] - b[0]
        );

        // í˜„ì¬ ì‹œê°„
        int currentTime = 0;
        // ì‹¤í–‰ í”„ë¡œì„¸ìŠ¤ ìˆœë²ˆ
        int jobIndex = 0;
        int totalTurnaroundTime = 0;
        // ì™„ë£Œëœ job
        int completedJobs = 0;

        // ëª¨ë“  jobì´ ì™„ë£Œ ë  ë•Œê¹Œì§€ loop
        while( completedJobs < jobs.length ){

            // ì§€ì •ëœ jobì´ ì¡´ì¬í•˜ë©° ìš”ì²­ ì‹œì ì´ í˜„ì¬ ì‹œê°„ë³´ë‹¤ ì‘ì„ ê²½ìš° ëŒ€ê¸°ì—´ ì¶”ê°€
            while (jobIndex < jobs.length && jobs[jobIndex][0] <= currentTime) {
                // ëŒ€ê¸°ì—´ ì¶”ê°€
                priorityQueue.offer(jobs[jobIndex]);
                // ì¸ë±ìŠ¤ ì¦ê°€
                jobIndex++;
            } // loop

            // íê°€ ë¹„ì–´ ìˆì§€ ì•Šì„ ê²½ìš° ì¡ì„ ì‹¤í–‰
            if (!priorityQueue.isEmpty()) {
                // í˜„ì¬ì˜ job ì •ë³´
                int[] currentJob = priorityQueue.poll();
                // í˜„ì¬ ì‹œê°„ + job ì‹¤í–‰ ì‹œê°„
                currentTime += currentJob[1];
                // ì‘ì—… ì¢…ë£Œ ì‹œê° - ì‘ì—… ìš”ì²­ ì‹œê°
                totalTurnaroundTime += currentTime - currentJob[0];
                // ì™„ë£Œëœ ì‘ì—… ì¶”ê°€
                completedJobs++;
            } else {
                // íê°€ ë¹„ì—ˆìœ¼ë©´ ë‹¤ìŒ ì‘ì—…ì˜ ìš”ì²­ ì‹œì ê¹Œì§€ ì‹œê°„ ì í”„
                currentTime = jobs[jobIndex][0];
            } // if - else
        } // while

        // ì´ ì†Œìš” ì‹œê°„ / job ê°œìˆ˜ë¥¼ í†µí•´ í‰ê· ì„ êµ¬í•¨
        return totalTurnaroundTime / jobs.length;
    }
}
